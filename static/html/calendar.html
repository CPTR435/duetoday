<!-- calendar.html -->
<script src='static/fullcalendar/lib/moment.min.js'></script>
<script src='static/fullcalendar/fullcalendar.min.js'></script>
<script>
function BuildMoreLink(items) {
    if (items == 0)
        return "";
    else if (items == 1)
        return "1 Item";
    else
        return items + " Items";
}

$(document).ready(function() {
	$('#calendar').fullCalendar({
        // Basic formatting
		theme: true,
		header: {
			left: 'prev today next',
			center: 'title',
			right: 'month,agendaWeek,agendaDay'
		},
		defaultDate: moment().format('MM/DD/YYYY'),
		editable: false,

        // Load events
		events: {
			url: 'events.json',
			error: function() {
				$('#script-warning').show();
			}
		},
		loading: function(bool) {
			$('#loading').toggle(bool);
		},

		// Make sure we don't have multiple scroll bars
		height: 'auto',
		contentHeight: 'auto',

        // When you click on day it takes you to day agenda
		dayClick: function(date, allDay, jsEvent, view) {
            $('#calendar').fullCalendar('gotoDate', date);
            $('#calendar').fullCalendar('changeView', 'agendaDay');
		},

		// Show number of events (see: http://stackoverflow.com/a/24024204)
		eventLimit: true, // allow "more" link when too many events
		eventLimitText: 'More',
		eventRender: function (event, element, view) {
            if (view.name == 'month') {
                var eventDateString = event.start.format("YYYY-MM-DD");
                var $calDay = $('td.fc-day[data-date="' + eventDateString + '"]');
                var dayEventCount = $calDay.attr('dayEventCount') ? parseInt($calDay.attr('dayEventCount')) : 0;

                dayEventCount = dayEventCount + 1;
                $calDay.attr('dayEventCount', dayEventCount);

                var missingEvents = dayEventCount;
                $('.moreLink', $calDay).remove();
                // Using container to get vertical alignment
                $moreContainer = $('<div class="moreContainer"/>');
                $moreLink = $('<div class="moreLink"/>');
                $moreLink.html(BuildMoreLink(missingEvents));
                $moreContainer.html($moreLink);
                $calDay.append($moreContainer);
                return false;
            }

            return true;
		}

		/* Use when needing selection...
        selectable: true,
		selectHelper: true,
		select: function(start, end) {
			start_str=start.format('MM/DD/YYYY')
			end_str=end.subtract(1, 'days').format('MM/DD/YYYY') // through end of previous
			if (start.diff(end, 'days') != 0) // Multiple days
				alert('Selected: '+start_str+' - '+end_str)
			$('#calendar').fullCalendar('unselect');
		},*/
	});

	// Full calendar swipe, see comment on
	// http://blog.arshaw.com/1/post/2014/08/fullcalendar-210-released.html
	// swipe initialize
	var recognizers = ["pan", "pinch", "press", "rotate", "tap"];
	var mc = new Hammer(document.getElementById("calendar"));

	for (i=0; i<recognizers.length; i++) {
		mc.get(recognizers[i]).set({enable:false});
	}
	/*mc.get('swipe').set({
		direction: Hammer.DIRECTION_HORIZONTAL,
		threshold: 30,
		velocity: 0.5
	});*/

	mc.on("swipeleft swiperight", function(ev) {
		if(ev.type=="swipeleft")
			$('#calendar').fullCalendar('next');
		else
			$('#calendar').fullCalendar('prev');
	});
});
</script>
<style>
#calendar {
	max-width: 900px;
	margin: 0 auto;
	padding-bottom: 1em;
}
div.moreLink {
    text-align: center;
    font-style: italic;
    height: 100%;
    display: table-cell;
    vertical-align: middle;
}
div.moreContainer {
    display: table;
    height: 100%;
    margin-left: auto;
    margin-right: auto;
}
</style>

<br><br>
<div class="row">
  <div class="small-12 columns">
    <!--<h1 style='text-align: center;'>This is the <b>Calendar</b></h1>-->
	<div id="script-warning" style="display: none">Note: could not load data.</div>
	<div id='calendar'></div>
	<div id='loading'>loading...</div>
  </div>
</div>
